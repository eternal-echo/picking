# 气阀

## 原理

使用RS-485进行通信，通信协议是MODBUS。

## 设置

拨码开关一共有 10 个位，分别是 B1 ~ B10，具体功能如下：

- B1 ~ B5 位用于设置**通信地址**； 
- B6~B7位用于设置**波特率**； 
- B8 暂时未用上 
- B9~B10用于设置**奇偶校验位**

## 示例

关闭所有输出 

Tx: 01 0F 00 00 00 14 03 00 00 00 50 75 

Rx: 01 0F 00 00 00 14 55 C4 

打开所有输出 

Tx: 01 0F 00 00 00 14 03 FF FF 0F 61 B1 

Rx: 01 0F 00 00 00 14 55 C4 

打开第一路输出

Tx:01 0F 00 00 00 14 03 01 00 00 01 B5 

Rx:01 0F 00 00 00 14 55 C4

在这个示例中，使用的MODBUS命令是"Write Multiple Registers"（0x0F）命令，用于将多个寄存器的值写入设备。命令的参数是：

- 要写入的寄存器的起始地址：00 00（寄存器地址为0x0000）
- 要写入的寄存器的数量：00 14（**20**个寄存器，每个寄存器为16位，所以需要40个字节）
- 要写入的数据（16位寄存器）的数量：01 （打开第一路输出） 或者 FF FF（打开所有输出） 或者 00 00（关闭所有输出）

对于示例中的每个操作，都使用相同的命令和参数，只是要写入的数据不同。

例如，在第一个操作中，数据是全0，这将关闭所有输出。在第二个操作中，数据是全1，这将打开所有输出。在第三个操作中，数据是0x0001，这将只打开第一路输出。

对于每个操作，设备都会响应一个确认消息，其中包含了设备的地址（01）、命令号（0x0F）、写入的寄存器的起始地址和数量（00 00 00 14），以及一个CRC校验码。

请注意，示例中的数据字节顺序可能是以大端模式表示，具体取决于设备的编程和处理器架构。